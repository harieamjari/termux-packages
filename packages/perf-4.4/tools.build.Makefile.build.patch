diff -uNr android-trusty-4.4/tools/build/Makefile.build android-trusty-4.4.mod/tools/build/Makefile.build
--- android-trusty-4.4/tools/build/Makefile.build	2024-04-11 13:24:41.199000000 +0800
+++ android-trusty-4.4.mod/tools/build/Makefile.build	2024-04-14 14:24:59.297994628 +0800
@@ -54,23 +54,36 @@
       cmd_mkdir = mkdir -p $(dir $@)
      rule_mkdir = $(if $(wildcard $(dir $@)),,@$(call echo-cmd,mkdir) $(cmd_mkdir))
 
+# remove architecture specific flags (-march=*) when hostbuilding fixdep
+define termux-patch-filter-cflags
+  $(if $(findstring fixdep,$1),$(filter-out -march=armv7-a -march=i686,$2),$2)
+endef
+
 # Compile command
 quiet_cmd_cc_o_c = CC       $@
-      cmd_cc_o_c = $(CC) $(c_flags) -c -o $@ $<
+      cmd_cc_o_c = $(CC) $(call termux-patch-filter-cflags,$@,$(c_flags)) -c -o $@ $<
 
 quiet_cmd_cc_i_c = CPP      $@
-      cmd_cc_i_c = $(CC) $(c_flags) -E -o $@ $<
+      cmd_cc_i_c = $(CC) $(call termux-patch-filter-cflags,$@,$(c_flags)) -E -o $@ $<
 
 quiet_cmd_cc_s_c = AS       $@
-      cmd_cc_s_c = $(CC) $(c_flags) -S -o $@ $<
+      cmd_cc_s_c = $(CC) $(call termux-patch-filter-cflags,$@,$(c_flags)) -S -o $@ $<
 
 quiet_cmd_gen = GEN      $@
 
+# ld.lld can't guess target emulation when
+# linking with an empty object created from cmd_ld_multi.
+# but we don't need to specify this when building
+# fixdep since it's going to be executed by host.
+define termux-patch-set-emulation
+  $(if $(findstring fixdep,$1),,-m $(PERF_LDEMULATION))
+endef
+
 # Link agregate command
 # If there's nothing to link, create empty $@ object.
 quiet_cmd_ld_multi = LD       $@
       cmd_ld_multi = $(if $(strip $(obj-y)),\
-		       $(LD) -r -o $@  $(filter $(obj-y),$^),rm -f $@; $(AR) rcs $@)
+		       $(LD) $(call termux-patch-set-emulation,$@) -r -o $@  $(filter $(obj-y),$^),rm -f $@; $(AR) rcs $@)
 
 # Build rules
 $(OUTPUT)%.o: %.c FORCE
